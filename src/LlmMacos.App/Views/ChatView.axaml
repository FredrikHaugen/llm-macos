<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="LlmMacos.App.Views.ChatView">
  <Grid Margin="6" RowDefinitions="Auto,*,Auto,Auto">
    <Border Classes="card">
      <StackPanel Spacing="10">
        <ComboBox ItemsSource="{Binding AvailableModels}"
                  SelectedItem="{Binding SelectedModel}"
                  HorizontalAlignment="Stretch"
                  MinWidth="360">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <Grid ColumnDefinitions="*,Auto">
                <StackPanel Spacing="2">
                  <TextBlock Text="{Binding RepoId}" />
                  <TextBlock Classes="subtle" Text="{Binding FileName}" />
                </StackPanel>
                <Border Grid.Column="1" Classes="badge" VerticalAlignment="Center" Margin="8,0,0,0">
                  <TextBlock FontWeight="SemiBold" Text="{Binding State}" />
                </Border>
              </Grid>
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>

        <WrapPanel ItemHeight="36">
          <Button Classes="primary" Content="Load Model" Command="{Binding LoadSelectedModelCommand}" />
          <Button Classes="subtle" Content="New Session" Command="{Binding NewSessionCommand}" Margin="10,0,0,0" />
          <Button Classes="subtle" Content="Refresh Models" Command="{Binding RefreshModelsCommand}" Margin="10,0,0,0" />
        </WrapPanel>
      </StackPanel>
    </Border>

    <Border Grid.Row="1" Classes="card" Margin="0,10,0,0">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding Messages}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Grid Margin="0,0,0,10" ColumnDefinitions="Auto,*">
                <Border Classes="badge"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Left"
                        Margin="0,1,0,0">
                  <TextBlock FontWeight="SemiBold" Text="{Binding Role}" />
                </Border>

                <Border Grid.Column="1"
                        Classes="listItem"
                        Margin="10,0,0,0"
                        Padding="10">
                  <TextBlock TextWrapping="Wrap" Text="{Binding Content}" />
                </Border>
              </Grid>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Border>

    <Border Grid.Row="2" Classes="card" Margin="0,10,0,0">
      <StackPanel Spacing="10">
        <TextBox AcceptsReturn="True"
                 TextWrapping="Wrap"
                 MinHeight="84"
                 Watermark="Type your prompt..."
                 Text="{Binding InputText}" />

        <WrapPanel ItemHeight="36">
          <Button Classes="primary" Content="Send" Command="{Binding SendCommand}" />
          <Button Classes="subtle" Content="Stop" Command="{Binding StopGeneratingCommand}" Margin="10,0,0,0" />
        </WrapPanel>
      </StackPanel>
    </Border>

    <TextBlock Grid.Row="3" Classes="subtle" Margin="4,10,0,0" Text="{Binding StatusMessage}" />
  </Grid>
</UserControl>
